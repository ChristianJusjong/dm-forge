<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dungeon Master Forge - Home</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="design-system.css">
  <link rel="stylesheet" href="medieval-theme.css">
  <link rel="stylesheet" href="responsive-design.css">
  <link rel="stylesheet" href="global-overrides.css">
</head>
<body>
  <div id="app">
    <!-- Navigation will be inserted here by nav.js -->

    <!-- Hero Section -->
    <main class="hero-section hero-section-enhanced stone-texture">
      <div class="hero-content">
        <div class="hero-logo-container">
          <div class="hero-logo-glow" aria-hidden="true"></div>
          <div class="hero-logo-wrapper">
            <img src="logo.svg" alt="Dungeon Master Forge - A glowing golden dragon emblem surrounded by mystical runes">
          </div>
          <h1 class="medieval-title">Dungeon Master Forge</h1>
          <div class="medieval-divider" aria-hidden="true"></div>
          <p class="hero-subtitle" data-i18n="welcomeSubtitle">Your Ultimate Campaign Companion</p>
        </div>

        <!-- Campaign Info & Session Management -->
        <div id="campaign-info" class="card" style="max-width: 800px; margin: 2rem auto; text-align: center;"></div>

        <!-- Feature Cards Grid -->
        <div class="cards-grid">
          <!-- Configuration Card -->
          <a href="configuration.html" class="feature-card feature-card-enhanced" data-category="setup">
            <div class="card-icon">âš™ï¸</div>
            <h3 data-i18n="configuration">Configuration</h3>
            <p>Configure your campaign, party, and session settings</p>
            <div class="card-footer">
              <span class="card-tag">Setup</span>
            </div>
          </a>

          <!-- Initiative Tracker Card -->
          <a href="initiative.html" class="feature-card feature-card-enhanced" data-category="combat">
            <div class="card-icon torch-glow">âš”ï¸</div>
            <h3 data-i18n="initiative">Initiative Tracker</h3>
            <p data-i18n="initiativeDesc">Track combat initiative, HP, AC, and conditions in real-time</p>
            <div class="card-footer">
              <span class="card-tag">Combat</span>
            </div>
          </a>

          <!-- Encounter Builder Card -->
          <a href="encounters.html" class="feature-card feature-card-enhanced" data-category="combat">
            <div class="card-icon torch-glow">ğŸ‘¹</div>
            <h3 data-i18n="encounters">Encounter Builder</h3>
            <p data-i18n="encountersDesc">Design and balance encounters for your party</p>
            <div class="card-footer">
              <span class="card-tag">Combat</span>
            </div>
          </a>

          <!-- Monster Browser Card -->
          <a href="monsters.html" class="feature-card feature-card-enhanced" data-category="reference">
            <div class="card-icon torch-glow">ğŸ‰</div>
            <h3 data-i18n="monsters">Monster Browser</h3>
            <p>Browse SRD monsters with D&D Beyond integration</p>
            <div class="card-footer">
              <span class="card-tag">Reference</span>
            </div>
          </a>

          <!-- NPC Generator Card -->
          <a href="npcs.html" class="feature-card feature-card-enhanced" data-category="creative">
            <div class="card-icon torch-glow">ğŸ§™</div>
            <h3 data-i18n="npcs">NPC Generator</h3>
            <p data-i18n="npcsDesc">AI-powered NPC creation with Gemini</p>
            <div class="card-footer">
              <span class="card-tag">AI-Powered</span>
            </div>
          </a>

          <!-- Inspiration & Random Tables Card -->
          <a href="inspiration.html" class="feature-card feature-card-enhanced" data-category="creative">
            <div class="card-icon torch-glow">âœ¨</div>
            <h3 data-i18n="inspiration">Inspiration & Tables</h3>
            <p data-i18n="inspirationDesc">Random generators and dice roller</p>
            <div class="card-footer">
              <span class="card-tag">Random</span>
            </div>
          </a>

          <!-- Session Notes Card -->
          <a href="notes.html" class="feature-card feature-card-enhanced" data-category="organization">
            <div class="card-icon torch-glow">ğŸ“</div>
            <h3 data-i18n="notes">Session Notes</h3>
            <p data-i18n="notesDesc">Track your campaign and session details</p>
            <div class="card-footer">
              <span class="card-tag">Organization</span>
            </div>
          </a>

          <!-- API Test Card -->
          <a href="api-test.html" class="feature-card feature-card-enhanced" data-category="reference" style="opacity: 0.8; border: 2px dashed var(--wood-brown);">
            <div class="card-icon">ğŸ”§</div>
            <h3>API Test</h3>
            <p>Test connection to all external APIs (Groq, Gemini, Open5e)</p>
            <div class="card-footer">
              <span class="card-tag" style="background: var(--iron);">Tools</span>
            </div>
          </a>
        </div>
      </div>
    </main>
  </div>

  <!-- End Session Modal -->
  <div id="end-session-modal" class="modal-overlay" style="display: none;">
    <div class="modal">
      <h2 style="color: #d4af37; margin-bottom: 1.5rem;">ğŸ“œ End Session</h2>

      <p style="margin-bottom: 1.5rem; line-height: 1.8;">
        Save your session and get your campaign code to continue later.
      </p>

      <div class="input-group">
        <label class="input-label">Session Notes (Optional)</label>
        <textarea id="session-notes-textarea" class="textarea" rows="5" placeholder="What happened in this session?"></textarea>
      </div>

      <div class="modal-actions" style="margin-top: 2rem;">
        <button class="btn btn-primary" onclick="endSessionNow()">
          ğŸ’¾ End Session
        </button>
        <button class="btn" onclick="document.getElementById('end-session-modal').style.display='none'">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script src="auth.js"></script>
  <script src="translations.js"></script>
  <script src="campaign-manager.js"></script>
  <script src="nav.js"></script>
  <script src="ads.js"></script>
  <script>
    // Require authentication
    if (!requireAuth()) {
      // User will be redirected to login
      throw new Error('Authentication required');
    }

    // Display campaign info and session management
    function updateCampaignInfo() {
      const campaign = getActiveCampaign();
      const session = getActiveSession();
      const infoDiv = document.getElementById('campaign-info');

      if (!campaign) {
        // No campaign - show new campaign button
        infoDiv.style.display = 'block';
        infoDiv.innerHTML = `
          <h2 style="color: #d4af37; margin-bottom: 1rem;">âš”ï¸ No Active Campaign</h2>
          <p style="color: #e8d5b7; margin-bottom: 1.5rem; line-height: 1.8;">
            Start a new campaign or load an existing one to begin your adventure.
          </p>
          <button class="btn btn-primary" onclick="window.location.href='campaign-start.html'">
            ğŸ² Start / Load Campaign
          </button>
        `;
        return;
      }

      infoDiv.style.display = 'block';

      if (!session) {
        // No active session - show start button
        const settings = campaign.settings || {};
        const worldNames = {
          'forgotten-realms': 'Forgotten Realms',
          'eberron': 'Eberron',
          'greyhawk': 'Greyhawk',
          'dragonlance': 'Dragonlance',
          'ravenloft': 'Ravenloft',
          'spelljammer': 'Spelljammer',
          'planescape': 'Planescape',
          'dark-sun': 'Dark Sun',
          'mystara': 'Mystara',
          'birthright': 'Birthright',
          'critical-role': 'Critical Role',
          'homebrew': 'Homebrew',
          'other': 'Other'
        };
        const worldName = worldNames[settings.world] || settings.world || 'Forgotten Realms';
        const edition = settings.edition || '5e';
        const partyStatus = campaign.partyConfirmed
          ? '<span style="color: #4caf50;">âœ“ Confirmed</span>'
          : '<span style="color: #ff9800;">âš  Not Confirmed</span>';

        infoDiv.innerHTML = `
          <h2 style="color: #d4af37; margin-bottom: 0.5rem;">ğŸ“– ${campaign.name}</h2>
          <p style="color: #b8956a; font-size: 0.9rem; margin-bottom: 1rem;">
            ${worldName} â€¢ ${edition.toUpperCase()}
          </p>
          <p style="color: #e8d5b7; margin-bottom: 1rem;">
            Party: <strong style="color: #f0d06b;">${campaign.party.length} members</strong> ${partyStatus} |
            Sessions Completed: <strong style="color: #f0d06b;">${campaign.sessions.length}</strong>
          </p>
          <p style="color: #b8956a; font-size: 0.9rem; margin-bottom: 1.5rem;">
            Campaign Code: <code style="background: rgba(0,0,0,0.3); padding: 0.25rem 0.75rem; border-radius: 4px; letter-spacing: 0.1rem;">${campaign.code}</code>
          </p>
          <button class="btn btn-primary" onclick="startNewSession()">
            âš”ï¸ Start New Session
          </button>
          <button class="btn" onclick="window.location.href='configuration.html'">
            âš™ï¸ Configure Campaign
          </button>
          <button class="btn" onclick="window.location.href='campaign-start.html'">
            ğŸ”„ Switch Campaign
          </button>
        `;
      } else {
        // Active session - show session info and end button
        const duration = Math.floor((Date.now() - session.startedAt) / 60000);
        infoDiv.innerHTML = `
          <h2 style="color: #d4af37; margin-bottom: 0.5rem;">ğŸ“– ${campaign.name}</h2>
          <p style="color: #4caf50; font-weight: 700; margin-bottom: 1rem;">
            âœ… Session Active (${duration} min)
          </p>
          <p style="color: #e8d5b7; margin-bottom: 1.5rem;">
            Party Members: <strong style="color: #f0d06b;">${campaign.party.length}</strong>
          </p>
          <button class="btn btn-secondary" onclick="showEndSessionModal()">
            ğŸšª End Session
          </button>
        `;
      }
    }

    // Start new session
    function startNewSession() {
      const campaign = getActiveCampaign();

      if (!campaign.party || campaign.party.length === 0) {
        alert('Please set up your party first before starting a session!');
        window.location.href = 'configuration.html';
        return;
      }

      if (!campaign.partyConfirmed) {
        alert('Please confirm your party setup first!\n\nGo to Party Setup and click "Confirm Party & Continue".');
        window.location.href = 'configuration.html';
        return;
      }

      startSession();
      updateCampaignInfo();

      // Redirect to notes to start session notes
      window.location.href = 'notes.html';
    }

    // Show end session modal
    function showEndSessionModal() {
      document.getElementById('end-session-modal').style.display = 'flex';
    }

    // End session now
    function endSessionNow() {
      const notes = document.getElementById('session-notes-textarea').value;
      const campaign = getActiveCampaign();

      endSession(notes);

      // Show campaign code
      alert(`Session ended!\n\nYour campaign code: ${campaign.code}\n\nUse this code to continue your campaign later.`);

      document.getElementById('end-session-modal').style.display = 'none';
      updateCampaignInfo();
    }

    // Add staggered entrance animation to cards
    document.addEventListener('DOMContentLoaded', () => {
      updateCampaignInfo();

      const cards = document.querySelectorAll('.feature-card');
      cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
      });
    });
  </script>
</body>
</html>
